<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>حاسبة السعر والتفاصيل</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <!-- Google tag (gtag.js) - Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-MR5JHB74D0"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    // الإعداد الأساسي للحساب مالك
    gtag('config', 'G-MR5JHB74D0');
  </script>

  <style>
    :root{
      --primary:#18dcd8;
      --primary-700:#12b7b4;
      --success:#2fbf71;
      --success-700:#259c5d;
      --text:#1f2a2e;
      --radius:14px;
      --radius-lg:18px;
    }

    *{box-sizing:border-box;}
    html,body{margin:0;padding:0;}

    body{
      font-family:'IBM Plex Sans Arabic', sans-serif;
      background:#ffffff;
      color:var(--text);
      min-height:100vh;
    }

    .wrap{
      background:#ffffff;
      padding-bottom:40px;
    }

    header.site-head{
      width:100%;
      height:50px;
      padding:0 18px;
      display:flex;
      align-items:center;
      justify-content:center;
      background:linear-gradient(90deg,var(--primary),var(--primary-700));
      box-shadow:0 2px 4px rgba(0,0,0,.08);
    }

    .logo img{
      height:73px;
      object-fit:contain;
      display:block;
    }

    .card{
      width:100%;
      max-width:480px;
      margin:18px auto 0;
    }

    .card-head{
      padding:16px 18px 6px;
      text-align:center;
      background:#fff;
    }

    .card-title{
      font-size:1.05rem;
      font-weight:700;
      margin:0;
      color:#0e3f3f;
    }

    .card-sub{
      font-size:.82rem;
      margin:4px 0 0;
      color:#6b7b80;
    }

    .title-divider{
      width:100%;
      max-width:480px;
      margin:10px auto 18px;
      height:1px;
      background:linear-gradient(to right, transparent, var(--primary), transparent);
      position:relative;
    }

    .title-divider .arrow-down{
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%) rotate(45deg);
      width:12px;
      height:12px;
      border:solid var(--primary);
      border-width:0 2px 2px 0;
      border-radius:2px;
      background:#fff;
    }

    form.content{
      padding:16px 18px 18px;
      display:grid;
      gap:14px;
    }

    .grid{
      display:grid;
      gap:12px;
      grid-template-columns:1fr;
    }

    @media(min-width:640px){
      .grid{
        grid-template-columns:1fr 1fr;
      }
    }

    label{
      font-weight:600;
      font-size:.95rem;
      margin-bottom:4px;
      color:#123;
      position:relative;
      right:2px;
      display:block;
    }

    input[type="number"],
    select{
      width:100%;
      padding:12px 14px;
      font-size:1rem;
      border:1px solid #d9e5e6;
      border-radius:var(--radius);
      background:#fff;
      -webkit-appearance:none;
      appearance:none;
    }

    input[type="number"]:focus,
    select:focus{
      outline:none !important;
      border-color:var(--primary) !important;
      box-shadow:0 0 6px rgba(24,220,216,0.45) !important;
    }

    .select-wrap{
      position:relative;
    }

    .select-wrap select{
      padding-right:32px;
    }

    .select-wrap .select-icon{
      position:absolute;
      right:10px;
      top:50%;
      transform:translateY(-50%);
      color:var(--primary);
      font-size:1.1rem;
      pointer-events:none;
    }

    #calcBtn{
      width:100%;
      padding:12px 16px;
      border:none;
      border-radius:var(--radius);
      background:linear-gradient(180deg,var(--primary),var(--primary-700));
      color:#fff;
      font-weight:800;
      font-size:1.1rem;
      cursor:pointer;
      box-shadow:0 6px 14px rgba(18,220,216,.25);
      font-family: 'IBM Plex Sans Arabic', sans-serif;
    }

    #result{
      margin-top:18px;
      padding:14px 14px 16px;
      border-radius:var(--radius-lg);
      border:1px solid rgba(24,220,216,.22);
      background:rgba(255,255,255,.6);
      box-shadow:0 12px 30px rgba(0,0,0,.08);
      display:none;
    }

    #result.show{
      display:block;
    }

    #result .row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:8px 0;
      border-bottom:1px dashed rgba(0,0,0,.06);
      gap:10px;
    }

    #result .row:last-child{
      border-bottom:none;
    }

    #result .row-main{
      display:flex;
      align-items:center;
      gap:6px;
    }

    #result i{
      color:var(--primary);
      width:20px;
      text-align:center;
    }

    #result .label{
      font-weight:700;
      color:#0e3f3f;
    }

    #result .value{
      display:flex;
      align-items:center;
      color:#133;
      direction:rtl;
      text-align:left;
    }

    #result .value .num{
      direction:ltr;
      unicode-bidi:embed;
    }

    #result .value .unit{
      margin-right:6px;
    }

    .order-button{
      display:flex;
      align-items:center;
      justify-content:center;
      width:100%;
      margin-top:12px;
      padding:11px 16px;
      border-radius:calc(var(--radius) + 4px);
      font-weight:800;
      font-size:1.05rem;
      color:#fff;
      text-decoration:none;
      background:linear-gradient(180deg,var(--success),var(--success-700));
      box-shadow:0 10px 24px rgba(37,156,93,.26);
    }

    .section-divider{
      width:100%;
      max-width:480px;
      margin:25px auto;
      height:1px;
      background:linear-gradient(to right, transparent, var(--primary), transparent);
      position:relative;
    }

    .section-divider .arrow-up{
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%) rotate(-135deg);
      width:12px;
      height:12px;
      border:solid var(--primary);
      border-width:0 2px 2px 0;
      border-radius:2px;
      background:#fff;
    }

    .notes{
      width:100%;
      max-width:480px;
      margin:0 auto 24px;
      padding:0 18px;
      font-size:.70rem;
      display:flex;
      flex-direction:column;
      gap:8px;
      opacity:.9;
    }

    .note-row{
      display:flex;
      gap:8px;
      align-items:flex-start;
      line-height:1.6;
    }

    .note-icon{
      width:24px;
      height:24px;
      background:rgba(24,220,216,.10);
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      color:rgba(24,220,216,.7);
      font-size:.8rem;
    }

    .note-row span{
      opacity:.96;
    }

    .note-title{
      font-weight:800;
    }

  </style>
</head>

<body>

<div class="wrap">

  <header class="site-head">
    <div class="logo">
      <img src="https://cdn.imgpile.com/f/nQ5XZuf_xl.png" alt="Logo">
    </div>
  </header>

  <section class="card">

    <div class="card-head">
      <h1 class="card-title">يرجى إدخال المعلومات التالية</h1>
      <p class="card-sub">حدد الشكل وأدخل القياسات لتحصل على السعر فوراً</p>
    </div>

    <div class="title-divider">
      <span class="arrow-down"></span>
    </div>

    <form class="content" novalidate>

      <div class="grid">

        <div class="field">
          <label>الشكل</label>
          <div class="select-wrap">
            <select id="shape">
              <option value="مستطيل">مستطيل</option>
              <option value="مربع">مربع</option>
              <option value="دائري">دائري</option>
            </select>
            <i class="fa-solid fa-chevron-down select-icon"></i>
          </div>
        </div>

        <div class="field" id="heightGroup">
          <label id="labelHeight">الطول (سم)</label>
          <input type="number" id="height" placeholder="ادخل الطول بالسنتيمتر" min="1"/>
        </div>

        <div class="field" id="widthGroup">
          <label>العرض (سم)</label>
          <input type="number" id="width" placeholder="ادخل العرض بالسنتيمتر" min="1"/>
        </div>

      </div>

      <button type="button" id="calcBtn">احسب</button>
      <div id="result"></div>

    </form>

  </section>

  <div class="section-divider">
  </div>

  <div class="notes">

    <div class="note-row">
      <div class="note-icon"><i class="fa-solid fa-truck"></i></div>
      <span>
        <span class="note-title">سعر التوصيل:</span>
        بغداد <span class="highlight-number">5,000</span> | الــــــــمحافظات <span class="highlight-number">6,000</span>
      </span>
    </div>

    <div class="note-row">
      <div class="note-icon"><i class="fa-solid fa-maximize"></i></div>
      <span>
        <span class="note-title">زيادة بالطول:</span>
        يُضاف هامش <span class="highlight-number">3 سم</span> إلى قياس الطول.
      </span>
    </div>

  </div>

</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const PRICE_PER_UNIT = 14750;
  const ROUND_STEP = 250;
  const WA_NUMBER = "9647724522333";

  const MAX_H_CM = 2000;
  const MAX_W_CM = 200;

  const shapeEl  = document.getElementById("shape");
  const heightEl = document.getElementById("height");
  const widthEl  = document.getElementById("width");
  const widthGrp = document.getElementById("widthGroup");
  const labelHeight = document.getElementById("labelHeight");
  const resultBox = document.getElementById("result");
  const calcBtn = document.getElementById("calcBtn");

  // دالة إرسال حدث للأزرار إلى Google Analytics
  function trackButtonEvent(labelText) {
    if (typeof gtag !== "function") return;

    gtag("event", "button_click", {
      event_category: "button",
      event_label: labelText,   // هنا تكدر تتبع "احسب" أو "اطلب الآن"
      button_text: labelText,
      value: 1
    });
  }

  function clean(el){
    el.addEventListener("input",()=>{
      el.value = el.value.replace(/[^0-9]/g,"");
      if(el.value !== "" && Number(el.value) < 1) el.value = "1";
    });
  }

  clean(heightEl);
  clean(widthEl);

  function updateFields(){
    const shape = shapeEl.value;
    resultBox.classList.remove("show");
    resultBox.innerHTML = "";

    if(shape === "مستطيل"){
      widthGrp.style.display = "";
      labelHeight.textContent = "الطول (سم)";
      heightEl.placeholder = "ادخل الطول بالسنتيمتر";
      widthEl.placeholder  = "ادخل العرض بالسنتيمتر";

    }else{
      widthGrp.style.display = "none";
      widthEl.value = "";

      if(shape === "مربع"){
        labelHeight.textContent = "طول الضلع (سم)";
        heightEl.placeholder = "ادخل طول الضلع بالسنتيمتر";
      }else if(shape === "دائري"){
        labelHeight.textContent = "قطر الدائرة (سم)";
        heightEl.placeholder = "ادخل قطر الدائرة بالسنتيمتر";
      }
    }
  }

  shapeEl.addEventListener("change", updateFields);

  function computeArea(shape,h,w){
    const hM = h/100;
    if(shape==="مستطيل") return hM*(w/100);
    if(shape==="مربع") return hM*hM;
    if(shape==="دائري"){
      const r = hM/2;
      return Math.PI*r*r;
    }
    return 0;
  }

  function computePrice(shape,h,w){
    const hM = h/100;
    if(shape==="مستطيل" && w<=100) return hM*PRICE_PER_UNIT;
    if(shape==="دائري"){
      if(h<=100) return hM*PRICE_PER_UNIT;
      return (h/100)*(h/100)*PRICE_PER_UNIT;
    }
    return computeArea(shape,h,w)*PRICE_PER_UNIT;
  }

  function fmt(n){
    const r = Math.round(n/ROUND_STEP)*ROUND_STEP;
    return r.toLocaleString("en-US");
  }

  calcBtn.addEventListener("click", ()=>{
    const shape = shapeEl.value;
    const h = Number(heightEl.value);
    const w = Number(widthEl.value);

    if(!h || h<=0 || (shape==="مستطيل" && (!w || w<=0))){
      alert("يرجى إدخال قيم صحيحة.");
      return;
    }

    if(h > MAX_H_CM){
      alert("أقصى طول هو 20 متر (2000 سم).");
      return;
    }

    if(shape==="مستطيل" && w > MAX_W_CM){
      alert("أقصى عرض هو 2 متر (200 سم).");
      return;
    }

    // تتبع زر "احسب"
    trackButtonEvent("احسب");

    const price = computePrice(shape,h,w);
    const area = computeArea(shape,h,w);
    const weight = (area*0.0025*1250).toFixed(2);

    let dimsText;
    if(shape==="مستطيل") dimsText = `${h} × ${w}`;
    else if(shape==="مربع") dimsText = `${h} × ${h}`;
    else dimsText = `${h}`;

    const msg = encodeURIComponent(
      `مرحبا، أريد غطاء ${shape} بقياس ${dimsText} سم بسعر ${fmt(price)} د.ع`
    );

    const waLink = `https://wa.me/${WA_NUMBER}?text=${msg}`;

    resultBox.innerHTML = `
      <div class="row">
        <div class="row-main">
          <i class="fa-solid fa-money-bill-wave"></i>
          <div class="label">السعر</div>
        </div>
        <div class="value">
          <span class="num">${fmt(price)}</span>
          <span class="unit">د.ع</span>
        </div>
      </div>

      <div class="row">
        <div class="row-main">
          <i class="fa-solid fa-ruler"></i>
          <div class="label">القياس</div>
        </div>
        <div class="value">
          <span class="num">${dimsText}</span>
          <span class="unit">سم</span>
        </div>
      </div>

      <div class="row">
        <div class="row-main">
          <i class="fa-solid fa-weight-hanging"></i>
          <div class="label">الوزن</div>
        </div>
        <div class="value">
          <span class="num">${weight}</span>
          <span class="unit">كغم</span>
        </div>
      </div>

      <div class="row">
        <div class="row-main">
          <i class="fa-solid fa-arrows-v"></i>
          <div class="label">السُمك</div>
        </div>
        <div class="value">
          <span class="num">2.5</span>
          <span class="unit">ملم</span>
        </div>
      </div>

      <a class="order-button" href="${waLink}" target="_blank">
        اطلب الآن
      </a>
    `;

    resultBox.classList.add("show");

    // تتبع زر "اطلب الآن" (يتولد بعد الحساب)
    const orderBtn = resultBox.querySelector(".order-button");
    if (orderBtn) {
      orderBtn.addEventListener("click", function() {
        trackButtonEvent("اطلب الآن");
      });
    }
  });

  // استدعاء مبدئي لضبط الحقول حسب الشكل الافتراضي
  updateFields();
});
</script>

</body>
</html>
